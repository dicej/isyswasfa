package component:test;

interface baz {
  foo: func(s: string) -> string;
}

world round-trip {
  import wasi:clocks/monotonic-clock@0.2.0;
  import baz;
  export baz;
}

interface http-types {
  record request {
    method: string,
    uri: string,
    headers: list<tuple<string, list<u8>>>,
  }

  record response {
    status: u16,
    headers: list<tuple<string, list<u8>>>,
  }
}

interface http-handler {
  use wasi:io/streams@0.2.0.{input-stream};
  use http-types.{request, response};
  
  handle: func(request: request, body: option<input-stream>) -> tuple<response, option<input-stream>>;
}

world service {
  import isyswasfa:io/pipe;
  export http-handler;
}

world middleware {
  include service;
  import http-handler;
}

interface incoming-handler {
  use wasi:http/types@0.2.0.{incoming-request, outgoing-response};
 
  handle: func(request: incoming-request) -> outgoing-response;
}

world wasi-http-handler {
  export incoming-handler;
}
